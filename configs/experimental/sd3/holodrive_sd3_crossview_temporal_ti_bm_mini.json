{
    "device": "cuda",
    "ddp_backend": "nccl",
    "train_epochs": 82,
    "generator_seed": 0,
    "data_shuffle": true,
    "optimizer": {
        "_class_name": "torch.optim.AdamW",
        "lr": 1e-5
    },
    "lr_scheduler": {
        "_class_name": "torch.optim.lr_scheduler.ExponentialLR",
        "gamma": 1.0
    },
    "pipeline": {
        "_class_name": "dwm.pipelines.holodrive.DWM",
        "common_config": {
            "single_frame": true,
            "disable_crossview": false,
            "disable_temporal": true,
            "cat_condition": true,
            "cond_with_layout": true,
            "cond_with_cxt": false,
            "cond_with_action": false,
            "distribution_framework": "fsdp",
            "ddp_wrapper_settings": {
                "auto_wrap_policy": {
                    "_class_name": "torch.distributed.fsdp.wrap.ModuleWrapPolicy",
                    "module_classes": [
                        {
                            "_class_name": "get_class",
                            "class_name": "diffusers.models.attention.JointTransformerBlock"
                        },
                        {
                            "_class_name": "get_class",
                            "class_name": "dwm.models.crossview_temporal_dit.VTBasicTransformerBlock"
                        }
                    ]
                },
                "mixed_precision": {
                    "_class_name": "torch.distributed.fsdp.MixedPrecision",
                    "param_dtype": {
                        "_class_name": "get_class",
                        "class_name": "torch.float16"
                    }
                }
            }
        },
        "training_config": {
            "latent_sample_method": "sample",
            "train_ctsd": true,
            "train_maskgit": false,
            "train_bevformer": false,
            "train_lss": false,
            "train_feature_exchange": false,
            "text_prompt_condition_ratio": 0.8,
            "3dbox_condition_ratio": 0.8,
            "hdmap_condition_ratio": 0.8,
            "gradient_accumulation_steps": 1,
            "enable_grad_scaler": true
        },
        "inference_config": {
            "infer_feature_exchange": false,
            "guidance_scale": 3,
            "inference_steps": 50,
            "preview_image_size": [
                448,
                252
            ],
            "fid_evaluation_maximum_sample_count": 10000
        },
        "unet_load_state_args": {
            "strict": false
        },
        "layout_encoder_config": null,
        "bev_layout_encoder_config": null,
        "vq_point_cloud": null,
        "wm": {
            "_class_name": "dwm.models.joint.JointModel",
            "ctsd": {
                "_class_name": "dwm.models.crossview_temporal_dit.DiTCrossviewTemporalConditionModel",
                "attention_head_dim": 64,
                "caption_projection_dim": 1536,
                "in_channels": 16,
                "joint_attention_dim": 4096,
                "num_attention_heads": 24,
                "num_layers": 24,
                "out_channels": 16,
                "patch_size": 2,
                "pooled_projection_dim": 2048,
                "pos_embed_max_size": 192,
                "sample_size": 128,
                
                "enable_crossview": true,
                "enable_rowwise_crossview": true,
                "crossview_block_layers": [1, 3],
                "crossview_gradient_checkpointing": true,

                "enable_temporal": true,
                "enable_rowwise_temporal": true,
                "temporal_block_layers": [1, 3],
                "temporal_gradient_checkpointing": true,

                "mixer_type": "mixer", 

                "condition_image_adapter_config": {
                    "in_channels": 6,
                    "channels": [
                        1536,
                        1536,
                        1536,
                        1536,
                        1536,
                        1536
                    ],
                    "is_downblocks": [
                        true,
                        false,
                        false,
                        false,
                        false,
                        false
                    ],
                    "num_res_blocks": 2,
                    "downscale_factor": 8,
                    "use_zero_convs": true,
                    "gradient_checkpointing": true
                }
            },
            "maskgit": null,
            "bevformer": null,
            "lss": null
        },
        "pretrained_model_name_or_path": "/mnt/storage/user/wuzehuan/Downloads/models/stable-diffusion-3-medium-diffusers",
        "wm_ckpt_path": null,
        "ctsd_ckpt_path": "/mnt/storage/user/wuzehuan/Downloads/models/stable-diffusion-3-medium-diffusers/transformer/diffusion_pytorch_model.safetensors",
        "maskgit_ckpt_path": null,
        "bevformer_ckpt_path": null,
        "vq_point_cloud_ckpt_path": null,
        "vq_blank_code_path": null
    },
    "training_dataset": {
        "_class_name": "dwm.datasets.common.DatasetAdapter",
        "base_dataset": {
            "_class_name": "dwm.datasets.nuscenes.MotionDataset",
            "fs": {
                "_class_name": "dwm.fs.czip.CombinedZipFileSystem",
                "fs": {
                    "_class_name": "dwm.fs.dirfs.DirFileSystem",
                    "path": "/cache/aoss-v2.st-sh-01.sensecoreapi-oss.cn/users/wuzehuan",
                    "fs": {
                        "_class_name": "fsspec.implementations.local.LocalFileSystem"
                    }
                },
                "paths": [
                    "data/nuscenes/v1.0-mini.zip",
                    "data/nuscenes/nuScenes-map-expansion-v1.3.zip"
                ]
            },
            "dataset_name": "v1.0-mini",
            "split": "mini_train",
            "sequence_length": 1,
            "fps_stride_tuples": [
                [
                    0,
                    1
                ]
            ],
            "sensor_channels": [
                "CAM_FRONT_LEFT",
                "CAM_FRONT",
                "CAM_FRONT_RIGHT",
                "CAM_BACK_RIGHT",
                "CAM_BACK",
                "CAM_BACK_LEFT"
            ],
            "keyframe_only": true,
            "_3dbox_image_settings": {
                "color_table": {
                    "vehicle.car": [
                        0,
                        0,
                        255
                    ],
                    "vehicle.bus": [
                        128,
                        0,
                        255
                    ],
                    "vehicle.truck": [
                        255,
                        255,
                        0
                    ],
                    "vehicle.construction": [
                        128,
                        128,
                        255
                    ],
                    "vehicle.emergency": [
                        255,
                        128,
                        128
                    ],
                    "vehicle.trailer": [
                        255,
                        255,
                        255
                    ],
                    "vehicle.bicycle": [
                        128,
                        255,
                        0
                    ],
                    "vehicle.motorcycle": [
                        0,
                        255,
                        128
                    ],
                    "human.pedestrian": [
                        255,
                        0,
                        0
                    ],
                    "movable_object.barrier": [
                        64,
                        64,
                        64
                    ],
                    "movable_object.trafficcone": [
                        128,
                        128,
                        0
                    ]
                },
                "pen_width": 8
            },
            "hdmap_image_settings": {
                "path": "/mnt/storage/user/chenrui4/workspaces/worldmodels/data/nuScenes-map-expansion-v1.3_new.json"
            },
            "enable_camera_transforms": true,
            "enable_ego_transforms": true,
            "image_description_settings": {
                "path": "/cache/aoss-v2.st-sh-01.sensecoreapi-oss.cn/users/wuzehuan/workspaces/worldmodels/data/nuscenes_v1.0-mini_caption_v2_train.json",
                "time_list_dict_path": "/cache/aoss-v2.st-sh-01.sensecoreapi-oss.cn/users/wuzehuan/workspaces/worldmodels/data/nuscenes_v1.0-mini_caption_v2_times_train.json",
                "align_keys": [
                    "time",
                    "weather"
                ],
                "reorder_keys": true,
                "drop_rates": {
                    "environment": 0.04,
                    "objects": 0.08,
                    "image_description": 0.16
                }
            },
            "stub_key_data_dict": 
            {
                "crossview_attention_index":
                [
                    "content",
                    {
                        "_class_name": "torch.tensor",
                        "data": [
                            [
                                1.0,
                                1.0,
                                1.0,
                                0.0,
                                0.0,
                                0.0
                            ],
                            [
                                1.0,
                                1.0,
                                1.0,
                                0.0,
                                0.0,
                                0.0
                            ],
                            [
                                1.0,
                                1.0,
                                1.0,
                                0.0,
                                0.0,
                                0.0
                            ],
                            [
                                0.0,
                                0.0,
                                0.0,
                                1.0,
                                1.0,
                                1.0
                            ],
                            [
                                0.0,
                                0.0,
                                0.0,
                                1.0,
                                1.0,
                                1.0
                            ],
                            [
                                0.0,
                                0.0,
                                0.0,
                                1.0,
                                1.0,
                                1.0
                            ]
                        ]
                    }
                ]
            }
        },
        "transform_list": [
            {
                "old_key": "images",
                "new_key": "vae_images",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ColorJitter",
                            "brightness": 0.05,
                            "contrast": 0.15,
                            "saturation": 0.15
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "3dbox_images",
                "new_key": "3dbox_images",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "hdmap_images",
                "new_key": "hdmap_images",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "image_description",
                "new_key": "clip_text",
                "transform": {
                    "_class_name": "dwm.datasets.common.Copy"
                },
                "stack": false
            }
        ],
        "pop_list": [
            "images",
            "image_description"
        ]
    },
    "validation_dataset": {
        "_class_name": "dwm.datasets.common.DatasetAdapter",
        "base_dataset": {
            "_class_name": "dwm.datasets.nuscenes.MotionDataset",
            "fs": {
                "_class_name": "dwm.fs.czip.CombinedZipFileSystem",
                "fs": {
                    "_class_name": "dwm.fs.dirfs.DirFileSystem",
                    "path": "/cache/aoss-v2.st-sh-01.sensecoreapi-oss.cn/users/wuzehuan",
                    "fs": {
                        "_class_name": "fsspec.implementations.local.LocalFileSystem"
                    }
                },
                "paths": [
                    "data/nuscenes/v1.0-mini.zip",
                    "data/nuscenes/nuScenes-map-expansion-v1.3.zip"
                ]
            },
            "dataset_name": "v1.0-mini",
            "split": "mini_val",
            "sequence_length": 1,
            "fps_stride_tuples": [
                [
                    0,
                    3
                ]
            ],
            "sensor_channels": [
                "CAM_FRONT_LEFT",
                "CAM_FRONT",
                "CAM_FRONT_RIGHT",
                "CAM_BACK_RIGHT",
                "CAM_BACK",
                "CAM_BACK_LEFT"
            ],
            "keyframe_only": true,
            "_3dbox_image_settings": {
                "color_table": {
                    "vehicle.car": [
                        0,
                        0,
                        255
                    ],
                    "vehicle.bus": [
                        128,
                        0,
                        255
                    ],
                    "vehicle.truck": [
                        255,
                        255,
                        0
                    ],
                    "vehicle.construction": [
                        128,
                        128,
                        255
                    ],
                    "vehicle.emergency": [
                        255,
                        128,
                        128
                    ],
                    "vehicle.trailer": [
                        255,
                        255,
                        255
                    ],
                    "vehicle.bicycle": [
                        128,
                        255,
                        0
                    ],
                    "vehicle.motorcycle": [
                        0,
                        255,
                        128
                    ],
                    "human.pedestrian": [
                        255,
                        0,
                        0
                    ],
                    "movable_object.barrier": [
                        64,
                        64,
                        64
                    ],
                    "movable_object.trafficcone": [
                        128,
                        128,
                        0
                    ]
                },
                "pen_width": 8
            },
            "hdmap_image_settings": {
                "path": "/mnt/storage/user/chenrui4/workspaces/worldmodels/data/nuScenes-map-expansion-v1.3_new.json"
            },
            "enable_camera_transforms": true,
            "enable_ego_transforms": true,
            "image_description_settings": {
                "path": "/cache/aoss-v2.st-sh-01.sensecoreapi-oss.cn/users/wuzehuan/workspaces/worldmodels/data/nuscenes_v1.0-mini_caption_v2_val.json",
                "time_list_dict_path": "/cache/aoss-v2.st-sh-01.sensecoreapi-oss.cn/users/wuzehuan/workspaces/worldmodels/data/nuscenes_v1.0-mini_caption_v2_times_val.json",
                "align_keys": [
                    "time",
                    "weather"
                ],
                "reorder_keys": true,
                "drop_rates": {
                    "environment": 0.04,
                    "objects": 0.08,
                    "image_description": 0.16
                }
            },
            "stub_key_data_dict": {
                "crossview_mask": [
                    "content",
                    {
                        "_class_name": "torch.tensor",
                        "data": [
                            [
                                1.0,
                                1.0,
                                1.0,
                                0.0,
                                0.0,
                                0.0
                            ],
                            [
                                1.0,
                                1.0,
                                1.0,
                                0.0,
                                0.0,
                                0.0
                            ],
                            [
                                1.0,
                                1.0,
                                1.0,
                                0.0,
                                0.0,
                                0.0
                            ],
                            [
                                0.0,
                                0.0,
                                0.0,
                                1.0,
                                1.0,
                                1.0
                            ],
                            [
                                0.0,
                                0.0,
                                0.0,
                                1.0,
                                1.0,
                                1.0
                            ],
                            [
                                0.0,
                                0.0,
                                0.0,
                                1.0,
                                1.0,
                                1.0
                            ]
                        ]
                    }
                ]
            }
        },
        "transform_list": [
            {
                "old_key": "images",
                "new_key": "vae_images",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "3dbox_images",
                "new_key": "3dbox_images_denorm",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "3dbox_images",
                "new_key": "3dbox_images",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "hdmap_images",
                "new_key": "hdmap_images_denorm",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "hdmap_images",
                "new_key": "hdmap_images",
                "transform": {
                    "_class_name": "torchvision.transforms.Compose",
                    "transforms": [
                        {
                            "_class_name": "torchvision.transforms.Resize",
                            "size": [
                                256,
                                448
                            ]
                        },
                        {
                            "_class_name": "torchvision.transforms.ToTensor"
                        }
                    ]
                }
            },
            {
                "old_key": "image_description",
                "new_key": "clip_text",
                "transform": {
                    "_class_name": "dwm.datasets.common.Copy"
                },
                "stack": false
            }
        ],
        "pop_list": [
            "images",
            "image_description"
        ]
    },
    "training_dataloader": {
        "batch_size": 1,
        "num_workers": 3,
        "prefetch_factor": 3,
        "collate_fn": {
            "_class_name": "dwm.datasets.common.CollateFnIgnoring",
            "keys": [
                "clip_text"
            ]
        },
        "persistent_workers": true
    },
    "validation_dataloader": {
        "batch_size": 1,
        "num_workers": 3,
        "prefetch_factor": 3,
        "collate_fn": {
            "_class_name": "dwm.datasets.common.CollateFnIgnoring",
            "keys": [
                "clip_text"
            ]
        },
        "persistent_workers": true
    },
    "preview_dataloader": {
        "batch_size": 1,
        "num_workers": 1,
        "shuffle": true,
        "drop_last": true,
        "collate_fn": {
            "_class_name": "dwm.datasets.common.CollateFnIgnoring",
            "keys": [
                "clip_text"
            ]
        },
        "persistent_workers": true
    }
}